<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Simplify</title>
    <link rel="stylesheet" href="../css/style.css">
    <script type="text/javascript" src="../../dist/paper-full.js"></script>
    <script type="text/paperscript" canvas="canvas">

        var hitOptions = {
            segments: true,
            stroke: true,
            fill: false,
            tolerance: 10
        };

        var path, segment, closed;

        function onMouseDown(event) {
            if (path) {
                segment = null;
                
                var hitResult = path.hitTest(event.point, hitOptions);
                if (!hitResult)
                    return;

                if (hitResult) {
                    path = hitResult.item;
                    if (hitResult.type == 'segment') {
                        segment = hitResult.segment;
                    } else if (hitResult.type == 'stroke') {
                        var location = hitResult.location;
                        segment = path.insert(location.index + 1, event.point);
                        path.smooth();
                    }
                }

            } else {
                path = new Path({
                    segments: [event.point],
                    strokeColor: 'black'
                });
                path.selected = true;
            }
        }

        function onMouseDrag(event) {
            if (closed) {
                if (segment) {
                    segment.point = event.point;
                    path.smooth();
                }
            } else {
                path.add(event.point);
            }
        }

        function onMouseUp(event) {
            if (closed) {

            } else {
                closed = true;
                path.simplify();
                path.smooth();
            }
        }
    </script>
</head>
<body>
    <canvas id="canvas" resize></canvas>
</body>
</html>
